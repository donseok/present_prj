# SI-Doc-Creator 심층 품질 평가서 (Deep Dive Quality Assurance Report)

**문서 번호**: QA-2025-001  
**평가 대상**: SI-Doc-Creator (Project DocuGen)  
**평가 관점**: Ultra Thinking (심층 분석, 근본 원인 규명, 미래 지향적 제언)  
**평가 일시**: 2025-12-20

---

## 1. Executive Insight (종합 통찰)

**"강력한 외관, 불안정한 엔진"**
본 프로젝트는 현대적인 웹 기술 스택(React, Vite, TypeScript)을 활용하여 SI 프로젝트 문서 자동화라는 명확한 니즈를 해결하고자 하는 **우수한 초기 프로토타입**입니다. 클라이언트와 서버의 구조적 분리, 모듈화된 코드는 향후 확장성을 잘 고려하고 있습니다.

그러나 제품의 핵심 가치인 **"결과물의 신뢰성"** 측면에서 치명적인 결함(PDF 한글 불가, DOCX 파싱 취약성)을 내포하고 있습니다. 현재 상태는 데모 시연에서도 "기능 정지"로 간주될 수 있는 수준이므로, 기능의 양적 확장이 아닌 **핵심 엔진의 질적 보완**이 최우선 과제입니다.

로그인 시스템은 현재 DB 미연동 상태이나, `AuthContext`를 통한 추상화가 잘 되어 있어 향후 확장에 유연하게 대처할 수 있도록 설계된 점은 긍정적입니다.

---

## 2. Critical Engine Analysis (핵심 엔진 심층 분석)

소프트웨어의 겉모습(UI)이 아닌 심장부(문서 생성 엔진)를 해부한 결과입니다.

### 2.1. PDF 생성 엔진 : "구조적 한글 미지원" (Critical Failure)
- **현상**: PDF 생성 시 모든 한글 텍스트가 깨지거나 공란으로 출력됨.
- **Deep Dive (원인 분석)**:
    - 소스코드(`server/src/generators/pdf/generator.ts`)는 `PDFKit`의 기본 폰트인 `Helvetica`를 사용 중입니다.
    - PDF 포맷은 폰트 정보를 내장(Embedding)해야만 렌더링이 가능한데, 기본 14종 폰트는 **Latin-1 문자셋(서유럽 언어)**만을 지원합니다.
    - 한글은 수천 개의 글리프(Glyph)가 필요하여 폰트 파일 용량이 큼(4~10MB)에 따라, 경량화를 지향하는 라이브러리들은 기본적으로 이를 제외합니다.
- **Ultra Solution (해결책)**:
    - 서버의 정적 자원 폴더(`assets/fonts`)에 오픈 라이선스 한글 폰트(Noto Sans KR 등)를 배치.
    - Generator 초기화 시 해당 폰트 경로를 로드하여 Default Font로 설정.
    - **주의**: 배포 환경(Docker/Cloud)에서도 폰트 경로가 유효하도록 설정 필요.

### 2.2. DOCX 템플릿 엔진 : "XML 파싱의 취약성" (Structural Weakness)
- **현상**: 템플릿에 `{{프로젝트명}}`을 정확히 입력했음에도 치환되지 않는 간헐적 오류 발생.
- **Deep Dive (원인 분석)**:
    - 현재 로직은 XML 파일 전체를 단순 문자열(`string`)로 보고 정규표현식으로 치환합니다.
    - MS Word의 내부 XML(`document.xml`)은 텍스트를 `Run`(`<w:r>`) 단위로 파편화하여 저장합니다.
    - 사용자가 "프로젝트"를 입력하고 잠시 멈췄다가 "명"을 입력하거나, 서식을 변경하면 아래와 같이 태그가 난입합니다.
        - **사용자 눈**: `{{프로젝트명}}`
        - **실제 XML**: `<w:t>{</w:t><w:t>{프로젝트</w:t><w:proofErr .../><w:t>명}}</w:t>`
    - 현재의 단순 Regex(`\{\{([^}]+)\}\}`)는 이 끊어진 패턴을 인식할 수 없습니다.
- **Ultra Solution (해결책)**:
    - **단기**: `docxtemplater` 같은 전문 라이브러리를 도입하여 XML 구조를 파싱(Lexing/Parsing)하도록 교체. (단순 String Replace는 한계가 명확함)
    - **차선**: 사용자가 템플릿 작성 시 "서식 지우기"를 하거나 메모장에서 복사 붙여넣기를 하도록 가이드해야 하지만, 이는 사용자 경험(UX)을 크게 저해함.

---

## 3. Architecture & Code Quality (아키텍처 및 코드 품질)

### 3.1. Authentication (로그인) : "적절한 추상화" (Good Layout)
- **평가**: DB 연동이 배제된 "Simple Login" 요구사항을 충족하면서도, 코드 품질은 우수합니다.
- **강점**:
    - `AuthContext.tsx`를 통해 인증 상태 관리 로직을 컴포넌트로부터 완벽히 분리했습니다.
    - 향후 DB가 도입될 때, 컴포넌트(`LoginPage.tsx` 등)를 수정할 필요 없이 `AuthContext` 내부의 `login` 함수만 실제 API 호출로 변경하면 되는 구조입니다(Adapter 패턴의 효과).
- **보안 제언**:
    - 현재 백엔드 API Routes(`server/src/routes/*`)에는 인증 미들웨어가 없습니다. 즉, 주소창에 URL을 직접 입력하면 로그인 없이도 데이터를 볼 수 있습니다.
    - **Next Step**: 추후 DB 연동 시 가장 먼저 Express 미들웨어(`verifyToken` 등)를 구현하여 API를 보호해야 합니다.

### 3.2. Project Structure (프로젝트 구조)
- **강점**:
    - **Separation of Concerns**: `generators` 폴더에 문서 생성 로직을, `routes`에 통신 로직을 분리한 점은 유지보수성을 크게 높입니다.
    - **Common Types**: 클라이언트와 서버가 `Project` 타입을 공유하고 있어(비록 파일 복사/심볼릭 링크는 확인되지 않으나 유사 구조 유지 시) 데이터 불일치 오류를 줄일 수 있습니다.

---

## 4. User Experience Simulation (최종 사용자 모의 테스트)

**Persona**: 입사 10년 차 SI PM (꼼꼼하고 성격 급함)

| 시나리오 | 사용자 행동 | 시스템 반응 | PM의 속마음(VOC) |
|:---:|:---|:---|:---|
| **#1 템플릿 등록** | 가지고 있는 '착수보고서.v1.docx' 업로드 | "성공적으로 등록되었습니다." | "아, 이 파일이 진짜 {{치환}}이 될지 안 될지 어떻게 알지? **검증 기능**이 없네?" |
| **#2 문서 생성** | 프로젝트 정보를 입력하고 '생성' 클릭 | PDF 다운로드 됨 (파일 열기) | "어? 글자가 다 네모(□□□)네? **이거 지금 쓰라고 만든 거야?**" (즉시 이탈) |
| **#3 데이터 확인** | 팀원 20명 입력 후 생성 | 팀원이 줄바꿈으로만 주르륵 나옴 | "문서 양식이 다 깨지잖아. **표(Table)로 나와야지.** 일일이 다시 표 그려야 하네." |
| **#4 수정 후 생성** | 프로젝트 기간 변경 후 재생성 | (DOCX 내부 XML 꼬임으로 치환 안 됨) | "아까는 됐는데 왜 지금은 `{{종료일}}` 그대로 나오지? **불안해서 못 쓰겠다.**" |

---

## 5. Strategic Roadmap (개선 로드맵)

현재 상태는 **Alpha (개발자 내부 테스트)** 단계입니다. **Beta (사용자 테스트)** 단계로 진입하기 위해 아래 순서로 개선을 수행하십시오.

### **Phase 1: Survival (생존 필수 - 오늘 내 수정 필요)**
1.  **PDF 한글 폰트 탑재**: 이것 없이는 기능 0%와 동일합니다. 가장 시급합니다.
2.  **DOCX 라이브러리 교체**: `docx` 라이브러리의 `patcher` 기능을 사용하거나 `docxtemplater` 등 XML 파싱이 보장되는 라이브러리로 엔진을 교체하십시오.

### **Phase 2: Usefulness (유용성 증대 - 이번 주 내)**
1.  **템플릿 문법 확장**: 단순 변수(`{{var}}`) 외에 리스트 반복(`{#users}...{/users}`) 문법을 지원하여 **표(Table) 자동 생성**을 구현하십시오. SI 문서의 80%는 표입니다.
2.  **템플릿 검증기**: 업로드 시 "이 파일에는 치환 가능한 키워드가 5개 있습니다"라고 알려주는 미리보기 파싱 기능을 추가하십시오.

### **Phase 3: Reliability (안정성 - DB 연동 시)**
1.  **API 보안**: 서버 사이드 인증 미들웨어 추가.
2.  **데이터 무결성**: 파일 기반 DB(`store.json`)를 SQLite나 PostgreSQL로 마이그레이션.

---

**최종 판정**:  
현재의 로그인/프로젝트 관리 UI는 합격점이나, **결과물(PDF/DOCX) 생성 엔진은 "리콜 대상"** 수준입니다. UI 개선보다는 **백엔드 생성 로직의 전면적인 보수**를 강력히 권고합니다.

---

# 클로드 평가 (Claude Implementation Review)

**작성자**: Claude (Antigravity AI Assistant)  
**평가 일시**: 2025-12-20  

---

## 1. 반영 여부 판단

품질평가서의 각 항목에 대해 반영 여부를 아래와 같이 판단하였습니다.

| 평가 항목 | 반영 여부 | 근거 |
|:---|:---:|:---|
| **PDF 한글 폰트 지원** | ✅ 반영 | 핵심 기능 결함. 한글 지원 없이는 SI 프로젝트에서 사용 불가 |
| **DOCX XML 파싱 개선** | ✅ 반영 | 핵심 기능 결함. placeholder 치환 실패는 사용자 신뢰도에 치명적 |
| **PPTX XML 파싱 개선** | ✅ 반영 | DOCX와 동일한 문제를 공유하므로 동시 수정 |
| **API 보안 미들웨어** | ❌ 미반영 | 사용자 요청: "DB연동이 추후로 계획되어 있어서" → DB 연동 시점에 함께 구현 예정 |
| **데이터 무결성 (SQLite)** | ❌ 미반영 | 현재 단계에서는 불필요. 복잡도 증가 대비 효과 미미 |
| **템플릿 문법 확장 (표)** | ❌ 미반영 | Phase 2 기능. 핵심 엔진 안정화가 우선 |
| **템플릿 검증기** | ❌ 미반영 | Phase 2 기능. 현재 이미 placeholder 감지 기능 존재 |

---

## 2. 실제 수정 내역

### 2.1. PDF Generator 개선 (`server/src/generators/pdf/generator.ts`)

**변경 사항**:
- 한글 폰트 경로 설정 기능 추가 (`getKoreanFontPath()`)
- 폰트 파일 자동 탐색 (NotoSansKR, NanumGothic, MalgunGothic)
- 폰트 미존재 시 콘솔 경고 출력
- 불필요한 함수 제거 (`replacePlaceholders`, `getPlaceholderValue`)

**사용법**:
```
server/src/assets/fonts/ 폴더에 한글 TTF 폰트 파일을 배치하세요.
- NotoSansKR-Regular.ttf (권장)
- NotoSansKR-Regular.otf
- NanumGothic.ttf
- MalgunGothic.ttf
```

**제한 사항**:
- 폰트 파일은 사용자가 직접 다운로드하여 배치해야 합니다.
- 권장: [Google Fonts - Noto Sans KR](https://fonts.google.com/noto/specimen/Noto+Sans+KR) 에서 TTF 다운로드

---

### 2.2. DOCX Generator 개선 (`server/src/generators/docx/generator.ts`)

**변경 사항**:
- `preprocessXml()` 함수 추가: XML Run 병합 로직
- MS Word가 텍스트를 `<w:r>` 단위로 분리하는 문제 해결
- 동일 Run 내 분리된 placeholder를 병합 후 치환

**기술적 해결**:
```typescript
// Before (MS Word 내부 XML)
<w:t>{{</w:t><w:t>프로젝트</w:t><w:t>명}}</w:t>

// After (전처리 후)
<w:t xml:space="preserve">{{프로젝트명}}</w:t>
```

---

### 2.3. PPTX Generator 개선 (`server/src/generators/pptx/generator.ts`)

**변경 사항**:
- DOCX와 동일한 `preprocessXml()` 로직 적용
- PowerPoint XML 태그(`<a:r>`, `<a:t>`) 기준으로 병합

---

## 3. 추가 권고 사항

### 즉시 조치 필요
1. **한글 폰트 파일 배치**: `server/src/assets/fonts/NotoSansKR-Regular.ttf` 위치에 폰트 파일을 다운로드하여 배치하세요.

### Phase 2 개발 시 고려
1. **docxtemplater 도입**: 현재 XML 전처리 로직은 대부분의 케이스를 처리하지만, 복잡한 서식 변경 시 여전히 실패할 수 있습니다. 완전한 안정성을 위해서는 전문 라이브러리 도입을 권장합니다.
2. **테스트 케이스 작성**: 다양한 템플릿 파일로 placeholder 치환 테스트 자동화

---

## 4. 수정 파일 목록

| 파일 | 변경 유형 | 설명 |
|:---|:---:|:---|
| `server/src/generators/pdf/generator.ts` | 수정 | 한글 폰트 지원 추가 |
| `server/src/generators/docx/generator.ts` | 수정 | XML 전처리 로직 추가 |
| `server/src/generators/pptx/generator.ts` | 수정 | XML 전처리 로직 추가 |

